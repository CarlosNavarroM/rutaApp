<div class="form-container">
  <h3>Agregar Registro</h3>

  <form (ngSubmit)="agregarRegistro()" #registroForm="ngForm">
    <div>
      <label for="fecha">Fecha y Hora:</label>
      <input type="datetime-local" id="fecha" [(ngModel)]="nuevoRegistro.fecha" name="fecha" required />
    </div>

    <div *ngIf="turnos$ | async as turnos">
      <label for="turno">Turno:</label>
      <select id="turno" [(ngModel)]="nuevoRegistro.turno" name="turno" required>
        <option value="" disabled>Seleccionar Turno</option>
        <option *ngFor="let item of turnos" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <div *ngIf="vueltas$ | async as vueltas">
      <label for="vuelta">Vuelta:</label>
      <select id="vuelta" [(ngModel)]="nuevoRegistro.vuelta" name="vuelta" required>
        <option value="" disabled>Seleccionar Vuelta</option>
        <option *ngFor="let item of vueltas" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <div *ngIf="gestiones$ | async as gestiones">
      <label for="gestion">Gestión:</label>
      <select id="gestion" [(ngModel)]="nuevoRegistro.gestion" name="gestion" required>
        <option value="" disabled>Seleccionar Gestión</option>
        <option *ngFor="let item of gestiones" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <div *ngIf="locales$ | async as locales">
      <label for="local">Local:</label>
      <select id="local" [(ngModel)]="nuevoRegistro.local" name="local" required>
        <option value="" disabled>Seleccionar Local</option>
        <option *ngFor="let item of locales" [value]="item.local">{{ item.local }}</option>
      </select>
    </div>

    <div *ngIf="conductores$ | async as conductores">
      <label for="conductor">Conductor:</label>
      <select id="conductor" [(ngModel)]="nuevoRegistro.conductor" name="conductor" required>
        <option value="" disabled>Seleccionar Conductor</option>
        <option *ngFor="let item of conductores" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <div *ngIf="transportes$ | async as transportes">
      <label for="transporte">Transporte:</label>
      <select id="transporte" [(ngModel)]="nuevoRegistro.transporte" name="transporte" required>
        <option value="" disabled>Seleccionar Transporte</option>
        <option *ngFor="let item of transportes" [value]="item.patente">{{ item.patente }}</option>
      </select>
    </div>

    <div *ngIf="tiposCarga$ | async as tiposCarga">
      <label for="tipo_carga">Tipo Carga:</label>
      <select id="tipo_carga" [(ngModel)]="nuevoRegistro.tipo_carga" name="tipo_carga" required>
        <option value="" disabled>Seleccionar Tipo de Carga</option>
        <option *ngFor="let item of tiposCarga" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <div *ngIf="estados$ | async as estados">
      <label for="estado">Estado:</label>
      <select id="estado" [(ngModel)]="nuevoRegistro.estado" name="estado" required>
        <option value="" disabled>Seleccionar Estado</option>
        <option *ngFor="let item of estados" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <button type="submit" [disabled]="!registroForm.form.valid">
      Agregar Registro
    </button>
  </form>
</div>

<h3>Últimos Registros</h3>

<div *ngIf="cargando" class="loading">Cargando datos...</div>

<div *ngIf="!cargando && (registros$ | async) as registros">
  <div *ngIf="registros.length > 0" class="table-container">
    <table class="styled-table">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Hora</th>
          <th>Turno</th>
          <th>Vuelta</th>
          <th>Gestión</th>
          <th>Local</th>
          <th>Conductor</th>
          <th>Transporte</th>
          <th>Tipo Carga</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of registros?.slice(-10)">
          <td>
            {{
            item.fecha?.toDate
            ? (item.fecha.toDate() | date : 'dd/MM/yyyy')
            : (item.fecha | date : 'dd/MM/yyyy')
            }}
          </td>
          <td>
            {{
            item.fecha?.toDate
            ? (item.fecha.toDate() | date : 'HH:mm')
            : (item.fecha | date : 'HH:mm')
            }}
          </td>
          <td>{{ item.turno }}</td>
          <td>{{ item.vuelta }}</td>
          <td>{{ item.gestion }}</td>
          <td>{{ item.local }}</td>
          <td>{{ item.conductor }}</td>
          <td>{{ item.transporte }}</td>
          <td>{{ item.tipo_carga }}</td>
          <td>{{ item.estado }}</td>
          <td>
            <button (click)="confirmarEliminar(item.id)">❌</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="registros.length === 0" class="no-data">
    No hay registros disponibles.
  </div>
</div>