
<!-- Formulario para agregar un nuevo registro -->
<div class="form-container">
  <h3>Agregar Registro</h3>
  <form (ngSubmit)="agregarRegistro()" #registroForm="ngForm">
    
    <!-- Campo de fecha y hora -->
    <div>
      <label for="fecha">Fecha y Hora:</label>
      <input type="datetime-local" id="fecha" [(ngModel)]="nuevoRegistro.fecha" name="fecha" required autocomplete="off" aria-label="Fecha y hora del despacho" />
    </div>

    <!-- Selector de turno -->
    <div *ngIf="turnos$ | async as turnos">
      <label for="turno">Turno:</label>
      <select id="turno" [(ngModel)]="nuevoRegistro.turno" name="turno" required>
        <option value="" disabled>Seleccionar Turno</option>
        <option *ngFor="let item of turnos; trackBy: trackByNombre" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <!-- Selector de vuelta -->
    <div *ngIf="vueltas$ | async as vueltas">
      <label for="vuelta">Vuelta:</label>
      <select id="vuelta" [(ngModel)]="nuevoRegistro.vuelta" name="vuelta" required>
        <option value="" disabled>Seleccionar Vuelta</option>
        <option *ngFor="let item of vueltas; trackBy: trackByNombre" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <!-- Selector de gestión -->
    <div *ngIf="gestiones$ | async as gestiones">
      <label for="gestion">Gestión:</label>
      <select id="gestion" [(ngModel)]="nuevoRegistro.gestion" name="gestion" required>
        <option value="" disabled>Seleccionar Gestión</option>
        <option *ngFor="let item of gestiones; trackBy: trackByNombre" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <!-- Selector de local -->
    <div *ngIf="locales$ | async as locales">
      <label for="local">Local:</label>
      <select id="local" [(ngModel)]="nuevoRegistro.local" name="local" required>
        <option value="" disabled>Seleccionar Local</option>
        <option *ngFor="let item of locales; trackBy: trackByNombre" [value]="item.local">{{ item.local }}</option>
      </select>
    </div>

    <!-- Selector de conductor -->
    <div *ngIf="conductores$ | async as conductores">
      <label for="conductor">Conductor:</label>
      <select id="conductor" [(ngModel)]="nuevoRegistro.conductor" name="conductor" required>
        <option value="" disabled>Seleccionar Conductor</option>
        <option *ngFor="let item of conductores; trackBy: trackByNombre" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <!-- Selector de transporte -->
    <div *ngIf="transportes$ | async as transportes">
      <label for="transporte">Transporte:</label>
      <select id="transporte" [(ngModel)]="nuevoRegistro.transporte" name="transporte" required>
        <option value="" disabled>Seleccionar Transporte</option>
        <option *ngFor="let item of transportes; trackBy: trackByNombre" [value]="item.patente">{{ item.patente }}</option>
      </select>
    </div>

    <!-- Selector de tipo de carga -->
    <div *ngIf="tiposCarga$ | async as tiposCarga">
      <label for="tipo_carga">Tipo Carga:</label>
      <select id="tipo_carga" [(ngModel)]="nuevoRegistro.tipo_carga" name="tipo_carga" required>
        <option value="" disabled>Seleccionar Tipo de Carga</option>
        <option *ngFor="let item of tiposCarga; trackBy: trackByNombre" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <!-- Selector de estado -->
    <div *ngIf="estados$ | async as estados">
      <label for="estado">Estado:</label>
      <select id="estado" [(ngModel)]="nuevoRegistro.estado" name="estado" required>
        <option value="" disabled>Seleccionar Estado</option>
        <option *ngFor="let item of estados; trackBy: trackByNombre" [value]="item.nombre">{{ item.nombre }}</option>
      </select>
    </div>

    <!-- Botón para enviar el formulario -->
    <button type="submit" [disabled]="!registroForm.form.valid">
      Agregar Registro
    </button>
  </form>
</div>

<!-- Sección de filtros -->
<div class="filter-container">
  <h3>Filtrar Registros</h3>
  <div class="filter-controls">

    <!-- Filtro por conductor -->
    <div *ngIf="conductores$ | async as conductores">
      <label for="filterConductor">Conductor:</label>
      <select id="filterConductor" [(ngModel)]="filterCriteria.conductor" name="filterConductor" (change)="applyFilters()">
        <option value="">Todos los Conductores</option>
        <option *ngFor="let conductor of conductores; trackBy: trackByNombre" [value]="conductor.nombre">{{ conductor.nombre }}</option>
      </select>
    </div>

    <!-- Filtro por fecha -->
    <div>
      <label for="filterFecha">Fecha:</label>
      <input type="date" id="filterFecha" [(ngModel)]="filterCriteria.fecha" name="filterFecha" (change)="applyFilters()">
    </div>

    <!-- Filtro por turno -->
    <div *ngIf="turnos$ | async as turnos">
      <label for="filterTurno">Turno:</label>
      <select id="filterTurno" [(ngModel)]="filterCriteria.turno" name="filterTurno" (change)="applyFilters()">
        <option value="">Todos los Turnos</option>
        <option *ngFor="let turno of turnos; trackBy: trackByNombre" [value]="turno.nombre">{{ turno.nombre }}</option>
      </select>
    </div>

    <!-- Botón para limpiar filtros -->
    <button type="button" (click)="resetFilters()">Limpiar Filtros</button>
  </div>
</div>

<!-- Título de la tabla -->
<h3>Últimos Registros</h3>

<!-- Indicador de carga -->
<div *ngIf="cargando" class="loading">Cargando datos...</div>

<!-- Tabla de registros -->
<div *ngIf="!cargando && (registros$ | async) as registros">
  <div *ngIf="registros.length > 0" class="table-container">
    <div class="scrollable-table-wrapper">
      <table class="styled-table" role="table">
        <thead>
          <tr>
            <th scope="col">Fecha</th>
            <th scope="col">Hora</th>
            <th scope="col">Turno</th>
            <th scope="col">Vuelta</th>
            <th scope="col">Gestión</th>
            <th scope="col">Local</th>
            <th scope="col">Conductor</th>
            <th scope="col">Transporte</th>
            <th scope="col">Tipo Carga</th>
            <th scope="col">Estado</th>
            <th scope="col">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <!-- Fila por cada registro -->
          <tr *ngFor="let item of registros; trackBy: trackById">
            <td>{{ item.fecha?.toDate ? (item.fecha.toDate() | date : 'dd/MM/yyyy') : (item.fecha | date : 'dd/MM/yyyy') }}</td>
            <td>{{ item.fecha?.toDate ? (item.fecha.toDate() | date : 'HH:mm') : (item.fecha | date : 'HH:mm') }}</td>
            <td>{{ item.turno }}</td>
            <td>{{ item.vuelta }}</td>
            <td>{{ item.gestion }}</td>
            <td>{{ item.local }}</td>
            <td>{{ item.conductor }}</td>
            <td>{{ item.transporte }}</td>
            <td>{{ item.tipo_carga }}</td>
            <td>{{ item.estado }}</td>
            <td>
              <!-- Botón para eliminar registro -->
              <button type="button" (click)="confirmarEliminar(item.id)">❌</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Mensaje si no hay registros -->
  <div *ngIf="registros.length === 0" class="no-data">
    No hay registros disponibles.
  </div>
</div>
